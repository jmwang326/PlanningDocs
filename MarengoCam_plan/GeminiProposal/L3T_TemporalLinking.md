# L3T: Temporal Linking Technical Details

## Component: `TemporalLinker`

This document provides the specific technical parameters and logic for the `TemporalLinker` component.

---

## Matching Algorithm

The core of the `TemporalLinker` is a matching algorithm that runs for each new `LocalTrack` generated by the `ChunkProcessor`.

**For each `track_N+1` in the new chunk:**

1.  **Candidate Filtering:**
    -   Identify a set of candidate tracks from the previous chunk (`Chunk_N`).
    -   A track is a candidate if:
        -   It was visible in the 2-second overlap zone.
        -   It does not already have its `next_track` pointer set.

2.  **Spatial Continuity Match:**
    -   Calculate the distance between the `exit_cell` of each candidate track in `Chunk_N` and the `entry_cell` of `track_N+1`.
    -   If the distance for one and only one candidate is below a defined threshold, a match is confirmed.

3.  **Appearance Similarity Match (Tie-breaker):**
    -   If multiple candidates satisfy the spatial continuity check, a tie-breaker is required.
    -   Compare the Re-ID (Re-Identification) embedding of `track_N+1` with the embeddings of each candidate.
    -   The candidate with the highest appearance similarity score is chosen as the match.

4.  **Match Assignment:**
    -   The matching is strictly one-to-one. Once a track is linked, it cannot be linked to another.
    -   Update the pointers:
        -   `candidate_track_N.next_track = track_N+1.id`
        -   `track_N+1.previous_track = candidate_track_N.id`

---

## Identity & Uncertainty Propagation

When a link is established, identity information is inherited from the past track to the new track. This ensures that identity context is maintained over time.

-   **If `track_N` has a confirmed identity:**
    -   `track_N+1.global_agent_id = track_N.global_agent_id`

-   **If `track_N` has an uncertain identity:**
    -   `track_N+1.identity_candidates = track_N.identity_candidates`

This propagation ensures that when the `IdentityResolver` or `EvidenceProcessor` eventually resolves an identity for any track in the chain, the resolution can be applied to the entire chain.
